# Global POS 产品需求文档（PRD）

版本：v1.0  
状态：Draft（可执行版）  
日期：2026-02-20  
作者：产品/研发联合评估（基于当前代码基线 + 2026 主流 POS 能力对标）

---

## 1. 文档目标

本 PRD 用于将以下两部分合并成一份完整产品需求：

1. 当前项目已实现能力（以仓库代码为准）  
2. 对标 2026 年主流 POS（Toast、Square、及中国主流合作方对接能力）后的目标能力清单

该文档可直接用于：

- 研发排期（Roadmap）
- 架构设计评审
- 接口定义与联调
- 测试验收与上线标准

---

## 2. 产品愿景与定位

### 2.1 愿景

构建一个可全球化部署的餐饮 POS 平台，覆盖“堂食 + 外卖 + 自营线上 + 第三方配送 + 连锁总部运营”，并支持按国家/区域进行能力配置，不把渠道能力写死在代码中。

### 2.2 产品定位

- 对内：门店运营中枢（点单、出餐、收银、桌台、员工、报表）
- 对外：渠道与生态中台（外卖平台、配送平台、支付、会员、营销、设备）

### 2.3 关键设计原则

1. 可配置优先：渠道、支付、税制、菜单策略、营业规则必须配置化  
2. 多区域优先：中国、东南亚、美国、加拿大、爱尔兰可用同一产品内核  
3. 交易安全优先：订单、支付、库存、状态流转必须幂等可追踪  
4. 先保证闭环，再扩展深度：先“可跑全链路”，再做“精细化优化”

---

## 3. 当前版本能力基线（代码现状）

本节仅描述当前仓库内已可确认能力。

### 3.1 已实现能力（MVP）

1. 认证与角色
   - 员工注册（Waiter/Cashier）
   - 登录/登出（JWT Cookie）
   - 角色权限中间件（Admin/Waiter/Cashier）

2. 桌台管理
   - 新增桌台（tableNo、seats）
   - 桌台状态（Available/Booked）
   - 桌台关联当前订单

3. 菜单下单
   - 前端固定菜单分类与菜品
   - 购物车、客人信息、桌台选择
   - 创建订单（Cash/Online）

4. 订单管理
   - 下单、查单、订单列表
   - 订单状态更新（In Progress/Ready/Completed/Cancelled）

5. 支付能力
   - Stripe 创建支付单
   - 支付验签与服务端校验
   - Webhook 验签入库

6. 小票/账单
   - 前端发票弹窗与浏览器打印

7. 管理后台（基础）
   - 管理员页（指标、订单、加桌台）
   - 指标多数为静态展示，非完整经营数据闭环

### 3.2 当前架构特点

- 技术栈：MERN（Express + Mongo + React + Redux/React Query）
- API 形态：REST
- 数据模型：User/Table/Order/Payment
- 菜单与价格：当前存在前端常量 + 后端白名单价格映射

### 3.3 当前主要缺口（简述）

- 菜单、库存、渠道、营销、会员、财务对账、连锁化、报表、设备、合作方对接平台均未形成企业级闭环  
- “全渠道订单聚合”尚未抽象为可配置中台

### 3.4 当前实现状态（与 MODULE20 对齐）（2026-02-24 更新）

截至 2026-02，实现已超出 3.1 中“MVP 七条”范围，20 项模块 v1 均已落地。详细进度与剩余队列见 **`docs/MODULE20_PROGRESS_2026-02-21.md`**。阅读本 PRD 时请以 MODULE20 为“当前已实现能力”的权威对照，避免误以为仅具备 3.1 所列能力。

---

## 4. 目标范围（合并后完整产品）

### 4.1 In Scope（本 PRD 覆盖）

1. 门店运营核心：点单、桌台、出餐、收银、退款、交班  
2. 全渠道订单中台：多渠道接单、状态回传、菜单同步、失败补偿  
3. 菜单库存中心：总部下发、门店差异、86/沽清联动  
4. 支付结算中心：多通道、退款、对账  
5. 会员营销中心：积分、储值、券、活动  
6. 员工与组织：岗位、班次、工时、审计  
7. 分析报表：门店、区域、总部多层级  
8. 设备与生态：打印、KDS、扫码、客显、手持终端  
9. 合作方对接平台：API、Webhook、幂等、签名、限流

### 4.2 Out of Scope（当前阶段不做）

- 自研外卖配送运力网络（做对接，不自建骑手系统）
- 自研完整 ERP（只做餐饮运营关联范围）

---

## 5. 用户角色与核心场景

### 5.1 角色

1. 总部管理员（品牌/连锁运维）
2. 店长（门店经营管理）
3. 收银员（结账、退款、对账协助）
4. 服务员（开台、点单、催菜）
5. 厨房（KDS、出餐）
6. 财务（结算、对账、报表）
7. 渠道运营（外卖菜单、营业状态、活动）
8. 第三方合作方/集成商（API 对接）

### 5.2 典型场景

1. 堂食：开台 -> 点单 -> 厨房 -> 上菜 -> 结账 -> 交班  
2. 外卖：渠道来单 -> 注入 POS -> 厨房 -> 配送 -> 状态回传 -> 对账  
3. 连锁：总部改菜单 -> 按区域/门店生效 -> 渠道同步 -> 销量分析  
4. 经营：会员活动投放 -> 核销 -> 复购分析  
5. 财务：日结/月结 -> 通道对账 -> 差异处理

---

## 6. 功能清单（合并版）

> 以下为“当前功能 + 目标功能”统一清单，优先级定义：P0（必须）、P1（应做）、P2（增强）。

| 编号 | 模块 | 当前状态 | 目标状态 | 优先级 |
|---|---|---|---|---|
| M01 | 身份与权限 | 基础角色 | 细粒度 RBAC + 审计 | P0 |
| M02 | 桌台与堂食流程 | 基础开台 | 并台/拆台/转台/分单 | P0 |
| M03 | 订单中心 | 基础状态流转 | 多来源订单统一模型 | P0 |
| M04 | 全渠道订单聚合 | 未建设 | 可配置渠道中台 | P0 |
| M05 | 菜单中心 | 前端常量 | 后台可配置、多版本、多时段 | P0 |
| M06 | 库存与沽清 | 未建设 | 库存扣减、自动86、渠道同步 | P0 |
| M07 | 厨房生产/KDS | 未建设 | 工位路由、催菜、出餐链路 | P0 |
| M08 | 支付中台 | 单通道（Stripe） | 多通道编排 + 退款 | P0 |
| M09 | 现金管理 | 未建设 | 开关班、抽屉、存取款、盘点 | P0 |
| M10 | 会员与储值 | 未建设 | 积分、储值、等级、权益 | P0 |
| M11 | 优惠营销 | 未建设 | 券/满减/组合促销引擎 | P0 |
| M12 | 员工与劳动力 | 基础用户 | 排班、工时、打卡、权限策略 | P0 |
| M13 | 财务结算与对账 | 未建设 | 通道结算、差异追踪、报表 | P0 |
| M14 | 组织与连锁 | 未建设 | 总部-区域-门店配置体系 | P0 |
| M15 | 经营分析 | 静态指标为主 | 主题报表 + API 导出 | P0 |
| M16 | 离线与容灾 | 未建设 | 离线收银 + 重放机制 | P1 |
| M17 | 设备生态 | 浏览器打印 | 打印/KDS/扫码/客显/PDA | P1 |
| M18 | 合作方对接平台 | 内部 API | 合作方 API + Webhook + 对接治理 | P1 |
| M19 | 自助点餐/二维码 | 未建设 | 扫码点餐/自助机/桌码 | P1 |
| M20 | 合规与安全 | 基础安全 | 审计、隐私、密钥、合规策略 | P0 |
| M21 | 品牌与触点管理 | 小票模板分散 | 品牌中心（Logo/小票/广告屏/素材） | P1 |
| M22 | 收银与费用配置 | 未建设 | 小费比例、信用卡服务费、税费规则 | P0 |

---

## 6.1 20 项差距清单（显式版）

> 本节为“当前版本与 2026 主流 POS 的差距”单独列出，和上文模块一一对应，便于评审与立项。

1. 菜单中心（P0）  
   差距：当前菜单与价格主要来自前端常量/后端白名单，缺少后台可配置、多版本发布、时段菜单、门店差异化、渠道同步。

2. 实时库存与沽清联动（P0）  
   差距：缺少实时扣减、低库存预警、自动停售（86）、跨渠道库存一致性。

3. 全渠道订单聚合（P0）  
   差距：缺少多渠道统一接单/回传；当前未形成可配置渠道中台。  
   目标：按国家/区域模板启用渠道，门店独立配置，不写死平台名称。

4. 厨房生产链路/KDS（P0）  
   差距：缺少工位分发、备餐计时、催菜、出餐确认、KDS 状态同步。

5. 桌台高级能力（P0）  
   差距：缺少楼层图、并台/拆台/转台、分单/并单、按席位出菜。

6. 支付中台（P0）  
   差距：当前以单通道为主，缺少多支付路由、失败切换、退款/部分退款、支付补偿。

7. 现金管理闭环（P0）  
   差距：缺少开班/交班、抽屉流水、现金存取、盘点与差异分析。

8. 会员与储值（P0）  
   差距：缺少会员等级、积分、储值卡、权益与交易流水。

9. 优惠与促销引擎（P0）  
   差距：缺少券、满减、套餐促销、叠加/互斥规则、核销审计。

10. 劳动力管理（P0）  
   差距：缺少岗位排班、打卡、工时统计、提成规则、权限随岗位模板。

11. 财务对账（P0）  
   差距：缺少支付/订单/退款总账、渠道结算对账、差异归因、财务导出。

12. 连锁组织能力（P0）  
   差距：缺少总部-区域-门店层级、配置继承、批量下发、灰度控制。

13. 经营分析体系（P0）  
   差距：当前指标含静态展示，缺少销售/菜品/渠道/支付/库存主题分析与 API 导出。

14. 离线能力与容灾（P1）  
   差距：缺少断网收银、缓存重放、冲突处理与人工修复队列。

15. 设备生态（P1）  
   差距：当前主要浏览器打印，缺少打印机/KDS/扫码枪/客显/手持终端统一接入。

16. 合作方对接平台（P1）  
   差距：缺少合作方 API、Webhook 签名重试回放、幂等治理、限流与沙箱。

17. 自助点餐与二维码点餐（P1）  
   差距：缺少桌码点餐、自助机、门店线上点餐入口统一。

18. 餐零/供应链协同（P2）  
   差距：缺少采购、入库、退货、零售与餐饮订单协同能力。

19. 企业级安全与审计（P2）  
   差距：缺少关键操作审计体系、高风险动作审批、异常操作监控闭环。

20. 多国家本地化合规（P0）  
   差距：缺少按国家差异化的税务、支付、票据、数据合规配置框架。

21. 品牌与触点管理（P1）  
   差距：小票模板分散在订单/更多页，缺少统一品牌中心；广告屏与素材无后台配置。  
   目标：品牌中心集中管理 Logo、小票模板、广告屏配置、广告素材，小票与广告屏作为品牌宣传阵地。

22. 收银与费用配置（P0）  
   差距：缺少小费比例、信用卡服务费等后台可配置项。  
   目标：后台统一配置小费选项、信用卡/支付通道服务费比例、税费规则，收银时自动应用。

---

## 7. 详细需求（按模块）

## 7.1 M01 身份与权限（P0）

### 目标

支持多角色、细粒度授权与关键操作追踪。

### 需求

1. 角色模型：总部管理员、区域管理员、店长、收银、服务员、后厨、财务、只读分析  
2. 权限粒度：页面级 + 操作级 + 数据范围级（门店隔离）  
3. 审计日志：登录、改单、退款、取消、权限变更、导出  
4. 会话安全：Token 轮转、设备指纹、异常登录告警  

### 验收标准

- 任意高风险操作可追溯“谁、何时、从何终端、改了什么”

---

## 7.2 M02 桌台与堂食流程（P0）

### 需求

1. 桌台平面图（区域、桌型、座位）  
2. 并台、拆台、转台  
3. 分单、并单、按 seat/coursing 出菜  
4. 预约/到店排队（可与第三方预订系统集成）  

### 验收标准

- 服务高峰时可完成复杂换台与拆并单，账务与库存保持一致

---

## 7.3 M03 订单中心（P0）

### 需求

1. 统一订单模型：堂食/外卖/自提/扫码点餐  
2. 订单生命周期：创建、确认、备餐、完成、取消、退款  
3. 幂等机制：下单、改价、状态更新必须支持幂等键  
4. 订单异常工单：注入失败、状态冲突、重复单自动预警  

---

## 7.4 M04 全渠道订单聚合（P0，重点）

> 本模块必须“可配置”，不得写死平台。

### 需求目标

构建可按国家/区域启用的渠道中台，统一处理第三方平台订单、状态、菜单、营业信息。

### 关键原则

1. 渠道可插拔（Connector/Adapter）  
2. 市场模板化（Market Profile）  
3. 门店级连接配置（Store Connection）  
4. 映射规则可配置（菜单、税、状态、配送、支付）  
5. 支持多接入模式（直连 API / 聚合商 / 文件/人工兜底）

### 统一配置模型（核心）

1. `ChannelProvider`：渠道定义  
   - providerCode（内部唯一编码）  
   - channelType（marketplace / first_party / dispatch / social）  
   - capabilities（orders/menu/status/refund/webhook/availability）  
   - authType（OAuth/API Key/JWT/Signature）  
   - regionSupport（可用国家/区域）

2. `MarketProfile`：市场模板  
   - countryCode、currency、timezone  
   - defaultTaxPolicy  
   - defaultDeliveryMode  
   - defaultChannelSet（仅模板，不是写死）

3. `StoreChannelConnection`：门店渠道连接  
   - locationId + providerCode + externalStoreId  
   - credentialRef（密钥引用，不明文）  
   - menuMappingPolicy  
   - statusMappingPolicy  
   - enabled、syncMode、retryPolicy

4. `ChannelMappingRule`：映射规则  
   - 商品映射（平台 SKU <-> POS SKU）  
   - 修饰项映射（Modifier）  
   - 状态映射（平台状态 <-> 内部状态）  
   - 税费与服务费映射  
   - 取消/退款码映射

### 渠道管理后台要求

1. 渠道目录：按区域展示可启用渠道与能力标签  
2. 门店接入向导：授权 -> 拉店铺 -> 绑定 -> 菜单映射 -> 联调测试  
3. 状态监控：Webhook 延迟、失败率、重试次数、未确认订单  
4. 回放工具：按订单重放事件，修复漏单与状态丢失  

### 区域模板（示例，不写死）

1. 中国模板（示例）：可启用美团、饿了么等  
2. 东南亚模板（示例）：可启用 GrabFood、foodpanda、ShopeeFood 等  
3. 美国模板（示例）：可启用 Uber Eats、DoorDash、Grubhub 等  
4. 加拿大模板（示例）：可启用 Uber Eats、DoorDash、SkipTheDishes 等  
5. 爱尔兰模板（示例）：可启用 Deliveroo、Uber Eats、Just Eat 等

> 说明：模板是“预置建议”，每个国家/品牌可按合同与可用 API 实际配置。

### 验收标准

1. 新增一个渠道接入不需改动核心订单域模型  
2. 新增国家只需新增模板与映射规则，非代码分叉  
3. 单门店可独立开关任意渠道  
4. 渠道故障不影响门店本地 POS 主流程

---

## 7.5 M05 菜单中心（P0）

### 需求

1. 菜单实体：分类、菜品、规格、修饰、套餐、时段价  
2. 多版本发布：草稿、预发布、正式  
3. 区域/门店差异化：统一母版 + 局部覆盖  
4. 渠道菜单同步：全量/增量、审核回执、失败重推  

### 验收标准

- 任一菜品改价可在配置时限内同步到启用渠道

---

## 7.6 M06 库存与沽清（P0）

### 需求

1. 实时库存扣减（按订单行）  
2. 低库存预警、售罄自动下架（86）  
3. 渠道同步停售状态  
4. 日终盘点与差异校正

---

## 7.7 M07 厨房生产/KDS（P0）

### 需求

1. 工位路由（冷菜/热菜/酒水/甜品）  
2. 备餐计时、超时告警、催菜  
3. 出餐确认、传菜确认  
4. KDS 与 POS 双向状态同步

---

## 7.8 M08 支付中台（P0）

### 需求

1. 多支付通道配置（按国家/门店/渠道）  
2. 支付路由策略（优先级、失败切换）  
3. 全额/部分退款、原路退回  
4. 通道回调验签与幂等  

### 验收标准

- 任何支付单都能追踪到“创建、授权、扣款、退款、对账”全链路

---

## 7.9 M09 现金管理（P0）

### 需求

1. 开班/交班、现金抽屉操作流水  
2. 现金存入、取出、盘点  
3. 差异分析（应收 vs 实收）  

---

## 7.10 M10 会员与储值（P0）

### 目标

构建完整的客户管理、会员体系、储值卡与礼品卡能力，支持等级、积分、充值、核销等全生命周期管理。

### 7.10.1 客户管理

1. **客户档案**
   - 基础信息：姓名、手机号、邮箱、生日、性别、备注
   - 归属门店/区域（可选）
   - 消费统计：累计消费、订单数、最近消费时间
   - 标签：自定义标签（VIP、常客、新客等）

2. **客户识别**
   - 多渠道识别：手机号、会员码、二维码、微信 OpenID
   - 开台/结账时绑定客户到订单
   - 支持快速搜索（手机号尾号、姓名模糊）

### 7.10.2 会员等级

1. **等级定义**
   - 等级名称、图标、颜色
   - 升级条件：累计消费金额、累计订单数、注册时长
   - 降级规则（可选）：不活跃 N 天自动降级
   - 等级权益：积分倍率、专属折扣、生日礼、免配送费等

2. **等级配置**
   - 总部默认等级体系，区域/门店可覆盖
   - 等级变更记录与审计

### 7.10.3 积分

1. **积分规则**
   - 消费获得：每消费 X 元得 Y 积分（可按等级倍率）
   - 积分抵扣：Y 积分抵 X 元（可设最低消费门槛）
   - 积分有效期（可选）
   - 积分冻结/解冻（退款时扣回）

2. **积分流水**
   - 获得、抵扣、过期、调整、活动赠送
   - 可追溯每笔变动来源（订单号、活动 ID）

### 7.10.4 储值卡（充值卡）

1. **储值账户**
   - 每个会员可有一个或多个储值账户
   - 余额、冻结余额、总充值、总消费
   - 充值赠送规则（如充 500 送 50）

2. **充值**
   - 现金/刷卡/在线支付充值
   - 充值记录、票据、余额变动流水
   - 支持退充值（按合规策略）

3. **消费**
   - 结账时可选储值支付（部分或全额）
   - 与现金、银行卡等混合支付
   - 消费后余额扣减、流水记录

### 7.10.5 礼品卡

1. **礼品卡类型**
   - 固定面额（如 100/200/500 元）
   - 自定义面额
   - 卡密/实体卡号 +  PIN

2. **购买与激活**
   - 购买即激活，或需到店/线上激活
   - 有效期（可选）
   - 余额不可提现，仅消费

3. **核销**
   - 结账时输入卡号+PIN 或扫码核销
   - 支持部分核销（余额可多次使用）
   - 核销流水、剩余余额展示
   - 挂失/冻结/作废（按策略）

### 7.10.6 促销核销

1. **与优惠券联动**
   - 会员专享券、等级专属券
   - 结账时自动匹配可用券，或手动选择
   - 核销后扣减券库存、记录核销人/时间

2. **与储值/礼品卡联动**
   - 储值充值活动（充送）
   - 礼品卡购买满赠
   - 核销时校验活动有效性

### 后台入口

- 客户管理：客户列表、详情、标签、消费分析
- 会员等级：等级配置、等级权益
- 积分：规则配置、流水查询、调整
- 储值卡：充值记录、消费流水、退充值
- 礼品卡：卡类型、购买记录、核销流水

### 验收标准

1. 客户可被识别、绑定订单，支持等级与积分。
2. 储值卡可充值、消费、退款，流水可追溯。
3. 礼品卡可购买、激活、核销，支持部分核销。
4. 促销/优惠券核销与会员、储值、礼品卡联动。

---

## 7.11 M11 优惠营销（P0）

### 目标

构建完整的折扣、促销、优惠券、BOGO 等营销能力，支持菜品级优惠、规则引擎、核销审计。

### 7.11.1 折扣类型

1. **整单折扣**
   - 按百分比（如 8 折）或固定金额（减 20 元）
   - 最低消费门槛（可选）
   - 适用渠道：堂食/外带/外卖（可配置）

2. **菜品级折扣**
   - 指定分类：某类菜品统一 X 折
   - 指定单品：某菜品 X 折或减 X 元
   - 指定套餐：套餐价直减
   - 时段价：不同时段不同价（早市/午市/晚市）

3. **满减**
   - 满 X 元减 Y 元
   - 满 X 件减 Y 元
   - 阶梯满减（满 100 减 10，满 200 减 25）

4. **买赠 / BOGO（Buy One Get One）**
   - 买 A 赠 B（指定赠品）
   - 买二送一、买一送一
   - 第二份半价
   - 可限制每单限用次数

### 7.11.2 优惠券（Coupon）

1. **券类型**
   - 折扣券：X 折或减 X 元
   - 满减券：满 X 减 Y
   - 单品券：指定菜品免费或特价
   - 包邮券、免配送费券（外卖场景）

2. **券发放**
   - 批量生成：券码、二维码、条码
   - 发放渠道：到店领取、线上领取、活动推送、会员专享
   - 每人限领数量、总量限制
   - 有效期：领取后 N 天有效，或固定起止日期

3. **券核销**
   - 结账时输入券码/扫码核销
   - 自动校验：有效期、适用门店、适用渠道、最低消费、互斥规则
   - 核销后状态变更、扣减库存
   - 核销流水：订单号、券码、核销人、时间

4. **券与促销叠加**
   - 可配置：券与满减/折扣是否可叠加
   - 优先级：先满减后折扣，或先折扣后满减（可配置）

### 7.11.3 促销活动

1. **活动配置**
   - 活动名称、类型（满减/折扣/BOGO/券包）
   - 活动时段、适用门店、适用渠道
   - 适用对象：全部/会员/指定等级
   - 互斥/叠加规则：与其它活动的关系

2. **活动类型**
   - 限时折扣：某时段全场或指定品类 X 折
   - 节日活动：国庆/中秋/双十一专题
   - 会员日：每周 X 会员专属
   - 新品推广：指定新品特价

3. **活动与菜品绑定**
   - 活动可关联指定分类/单品/套餐
   - 支持排除项（如酒水不参与）
   - 多活动并存时按优先级取最优

### 7.11.4 规则引擎

1. **互斥/叠加**
   - 互斥：同一订单只能使用一种（如满减与折扣二选一）
   - 叠加：满减 + 券可同享（需明确优先级与计算顺序）
   - 优先级：多个可用优惠时，按优先级取最优或允许手动选择

2. **计算顺序**
   - 建议顺序：原价 -> 菜品级折扣 -> 满减 -> 整单折扣 -> 券 -> 积分抵扣
   - 可配置，避免负单价

3. **防作弊**
   - 同一券码/账号限用次数
   - 异常核销告警（高频、异地、批量）
   - 核销审计日志

### 7.11.5 核销与审计

1. **核销流水**
   - 每笔核销记录：订单、优惠类型、优惠 ID、优惠金额、核销人、时间
   - 支持按订单、按券、按活动、按门店查询

2. **对账**
   - 促销成本核算：各活动/券的让利金额汇总
   - 与财务对账：优惠金额与实收一致性

### 后台入口

- 折扣管理：整单折扣、菜品折扣、满减、BOGO
- 优惠券：券类型、批量生成、发放记录、核销流水
- 促销活动：活动配置、活动与菜品绑定、互斥规则
- 规则引擎：叠加/互斥配置、计算顺序、防作弊策略

### 验收标准

1. 支持整单折扣、菜品折扣、满减、BOGO 等多种优惠类型。
2. 优惠券可生成、发放、核销，核销流水可追溯。
3. 促销活动可配置时段、门店、适用对象，与菜品联动。
4. 规则引擎支持互斥/叠加/优先级，计算顺序可配置。

---

## 7.12 M12 员工与劳动力（P0）

### 需求

1. 岗位与排班  
2. 打卡与工时  
3. 小费/提成规则  
4. 权限随岗位模板下发

---

## 7.13 M13 财务结算与对账（P0）

### 需求

1. 交易流水总账（订单、支付、退款）  
2. 渠道结算单导入与自动对账  
3. 差异自动归因（漏单、金额不一致、币种误差）  
4. 财务导出（门店/区域/总部）

---

## 7.14 M14 组织与连锁（P0）

### 需求

1. 组织层级：Brand -> Region -> Store  
2. 配置分层继承：总部默认 + 区域覆盖 + 门店覆盖  
3. 批量下发与灰度发布  
4. 跨门店账号数据隔离

---

## 7.15 M15 经营分析（P0）

### 需求

1. 销售、菜品、渠道、员工、支付、库存主题报表  
2. 实时看板 + T+1 稳定报表  
3. 自定义时间、门店、维度下钻  
4. API 导出供 BI 系统调用

---

## 7.16 M16 离线与容灾（P1）

### 需求

1. 断网本地下单与缓存  
2. 网络恢复后自动重放  
3. 冲突检测与人工修复队列

---

## 7.17 M17 设备生态（P1）

### 需求

1. 打印机（后厨/前台/分单）  
2. 扫码枪、客显、副屏  
3. 手持点餐设备与 KDS 终端  
4. 设备健康检查与告警

---

## 7.18 M18 合作方对接平台（P1）

### 需求

1. 对外 API（鉴权、范围、版本化）  
2. Webhook（签名、重试、回放）  
3. 幂等与限流  
4. 合作方接入文档与沙箱

---

## 7.19 M19 自助点餐/二维码（P1）

### 需求

1. 桌码点餐  
2. 自助机（Kiosk）  
3. 门店小程序/网页点餐  
4. 与主订单中心统一结算

---

## 7.20 M20 合规与安全（P0）

### 需求

1. PII 最小化与加密存储  
2. 密钥轮换与访问控制  
3. 高风险操作双人审批（可选）  
4. 合规审计报表（按国家/地区策略）

---

## 7.21 北美/欧洲硬件接入蓝图（Toast / Square 对标，P0-P1）

### 目标

构建“设备可配置、区域可落地、品牌可扩展”的硬件接入体系，覆盖：

1. 钱箱（Cash Drawer）
2. 小票机（Receipt Printer）
3. 刷卡机（EMV/NFC Terminal）
4. 自助点餐机（Kiosk）
5. 叫号机/叫号屏（Queue Calling）
6. 电视机（菜单/广告/叫号大屏）
7. 厨房出单（Kitchen Printer/KDS）
8. 前台出单（Front Receipt）

### 硬件能力清单（以能力抽象，不写死单一厂商）

1. 前台收银主机：Counter POS（双屏/客显可选）
2. 移动点单：Handheld / Mobile POS（桌边点单、弱网容错）
3. 支付终端：EMV + NFC + 磁条（按国家启用）
4. 前台打印：80mm 热敏票据、模板可配置
5. 厨房打印：后厨分档口打印（热敏/针打）
6. KDS：按工位派单、状态回传 POS
7. 现金抽屉：开箱审计、班次联动
8. Kiosk：自助点单 + 支付
9. Queue Display：取号/叫号显示
10. Signage：菜单与广告播放（店内电视）

### 区域约束（北美/欧洲）

1. 设备需按国家合规使用（尤其支付终端与商户账户绑定）。
2. 同品牌不同国家可售 SKU 可能不同，必须在“国家模板”中做白名单。
3. Square/Toast 某些组合形态存在外设限制，需在接入时预校验。
4. 叫号与电视大屏在行业中常通过 Web Signage 扩展层实现，不应与核心交易耦合。

### 系统设计要求

1. 设备目录（Catalog）：按国家/供应商/能力筛选。
2. 门店硬件画像（Store Hardware Profile）：配置门店实际设备组合。
3. 能力覆盖校验：自动校验是否覆盖支付、前台打印、厨房打印等关键能力。
4. 设备心跳与健康：离线告警、固件版本、网络状态。
5. 事件驱动：订单状态驱动 KDS、打印、叫号、Signage 同步。

### 验收标准

1. 单店可在不改代码前提下切换 Toast/Square/自定义扩展设备组合。
2. 新增硬件型号仅需更新目录与映射，不改订单核心逻辑。
3. 厨房与前台可独立打印且互不阻塞。
4. 叫号与菜单广告可独立发布，不影响 POS 主交易链路。

---

## 7.22 多业态模板化能力（P0）

### 目标

同一套 POS 内核可快速拆分为多个行业版本，减少分叉开发与维护成本。

### 首批模板范围

1. 奶茶店（Milk Tea）
2. 寿司（Sushi）
3. 广式早茶（Dim Sum）
4. 西餐（Western Dining）
5. 中式快餐（Chinese Fast Food）
6. 美甲店（Nail Salon）
7. 火锅店（Hotpot）

### 模板内容

1. 经营模式：堂食/外带/外卖/预约
2. 菜单选项模型：规格、修饰项、套餐、多轮加单
3. 桌台规则：是否启用并台/拆台/席位分单/长时段桌控
4. 厨房路由：工位拆分与票据策略
5. 硬件建议：推荐设备能力组合（与 7.21 联动）
6. 指标看板：按业态默认展示的 KPI

### 验收标准

1. 新门店可在创建时选择模板，一键生成默认规则。
2. 模板允许门店覆盖（Override），但保留总部默认继承关系。
3. 同一门店可平滑切换模板版本（含回滚策略）。

---

## 7.23 品牌与触点管理（M21，P1）

### 目标

将小票、广告屏等触点纳入统一的品牌管理，使门店的每次露出（小票、店内电视、叫号屏等）成为可配置的品牌宣传阵地，而不仅是“数据展示”。

### 设计原则

1. **品牌中心统一入口**：Logo、品牌信息、小票模板、广告屏、素材在后台「品牌管理」统一配置，不分散在订单、更多、设备等页面。
2. **触点即宣传**：小票、店内电视、叫号屏等不仅是数据载体，应支持品牌 Logo、标语、活动信息等露出。
3. **总部可下发、门店可覆盖**：品牌配置支持组织层级继承与门店级覆盖。

### 7.23.1 品牌与 Logo 设置

1. **品牌基础信息**
   - 品牌名称、英文名/缩写
   - 品牌 slogan/标语（可选）
   - 品牌主色、辅助色（供小票、广告屏等统一风格）

2. **Logo 管理**
   - Logo 图片上传（推荐尺寸、格式约束）
   - 主 Logo、浅色版/深色版（适配不同背景）
   - Logo 在小票、广告屏、叫号屏的展示开关与位置配置

3. **配置层级**
   - 总部默认 + 区域/门店覆盖
   - 支持按 locationId 差异化

### 7.23.2 小票模板（品牌化）

1. **归属调整**
   - 小票模板从订单域或「更多」页迁移至「品牌管理」子模块
   - 与小票模板关联：Logo、头部标题、底部信息、门店名称

2. **模板字段（扩展）**
   - 现有：storeName、headerTitle、footerMessage、fields（showOrderId/showTable/showGuests 等）
   - 新增：logoUrl（引用品牌 Logo）、brandSlogan、促销/活动文案区（可选）
   - 字段显示开关：按现有逻辑保留，并可扩展

3. **预览与发布**
   - 后台可预览小票效果
   - 支持草稿与发布状态
   - 变更可灰度到指定门店

### 7.23.3 广告屏配置管理

1. **广告屏设备**
   - 设备注册：设备编码、所属门店、物理位置（如「大厅主屏」「取餐区」）、分辨率
   - 设备与门店/区域绑定
   - 设备状态：在线/离线、最后心跳时间

2. **播放策略**
   - 默认内容类型：菜单展示、叫号、广告轮播、混合模式
   - 时段策略：营业时段播广告、非营业时段播待机画面
   - 优先级：叫号 > 菜单 > 广告轮播（可配置）

3. **内容源**
   - 绑定广告素材库（见 7.23.4）
   - 支持播放列表：素材按序/随机轮播
   - 可关联促销活动、新品上市等营销内容

4. **与现有能力的关系**
   - 与 7.21 硬件接入中的 Signage、Queue Display 能力对齐
   - 广告屏不耦合核心交易，通过事件/API 或独立播放器拉取内容

### 7.23.4 广告素材管理

1. **素材库**
   - 素材上传：图片、视频（格式、大小、时长约束）
   - 素材元数据：名称、分类标签、有效期、适用门店/区域
   - 素材状态：草稿、已发布、已下架

2. **素材分类**
   - 品牌宣传：Logo、品牌故事、价值观
   - 促销活动：满减、新品、会员日
   - 菜单展示：招牌菜、套餐推荐
   - 通用：待机画面、节日祝福

3. **版本与审核（可选）**
   - 素材版本历史
   - 敏感内容需审核后发布（按合规策略）

4. **使用与统计**
   - 素材被哪些广告屏/播放列表引用
   - 播放频次、曝光统计（若播放器支持上报）

### 后台入口与导航

建议在 Configuration 分组下新增「品牌管理」：

- 品牌与 Logo
- 小票模板
- 广告屏配置
- 广告素材

### 验收标准

1. 品牌 Logo、小票模板、广告屏、广告素材均在「品牌管理」统一配置。
2. 小票打印时展示 Logo 与品牌信息（若已配置）。
3. 广告屏可配置播放策略并引用素材库内容。
4. 素材支持上传、分类、发布，可与广告屏播放列表关联。

---

## 7.24 收银与费用配置（M22，P0）

### 目标

在后台统一配置小费选项、信用卡/支付通道服务费、税费规则等，收银时自动应用，避免硬编码。

### 7.24.1 小费配置

1. **小费比例选项**
   - 预设比例：如 0%、10%、15%、18%、20%、25%
   - 可多选启用，收银时展示供顾客选择
   - 支持自定义比例（如 12%、22%）
   - 按门店/区域差异化配置

2. **小费计算基础**
   - 应税前金额（小计）或含税后金额
   - 是否包含优惠减免后的金额
   - 可选：小费取整规则（舍、入、四舍五入到角/元）

3. **小费展示**
   - 小票是否打印小费行
   - 支付前确认页是否展示小费选项
   - 支持“无小费”选项（部分区域强制展示）

### 7.24.2 信用卡/支付通道服务费

1. **服务费比例**
   - 按支付方式：信用卡 X%，借记卡 Y%，第三方支付 Z%
   - 按通道：Stripe 2.9%+0.30，Square 2.6%+0.10 等（可配置）
   - 按国家/区域差异（如部分市场禁止向顾客转嫁）

2. **服务费展示**
   - 是否在账单中单独展示“支付手续费”
   - 或含入总价不单独列出（按合规要求）
   - 对账时需能拆分“商品金额”与“手续费”

3. **最低消费**
   - 信用卡/扫码最低消费额（可选）
   - 低于门槛时提示或禁止使用该方式

### 7.24.3 税费规则

1. **税率配置**
   - 默认税率、多档税率（食品/酒水/服务费不同税率）
   - 按国家/州/市配置
   - 免税场景（如外卖打包、B2B）

2. **税计算**
   - 税前/税后计算模式
   - 含税价与不含税价切换展示

### 7.24.4 其他费用

1. **配送费/打包费**
   - 按距离阶梯、按订单金额
   - 外卖/外带场景单独配置

2. **包间费/服务费**
   - 按桌型、按人数、按时长
   - 可纳入小费或单独列示

### 配置层级

- 总部默认 + 区域覆盖 + 门店覆盖（与 Settings 通用配置继承一致）
- 支持按 locationId 差异化

### 后台入口

建议在 **Settings** 或 **Configuration** 下新增「收银规则」：

- 小费配置
- 支付服务费配置
- 税费规则
- 其他费用

### 验收标准

1. 小费比例可在后台配置，收银时按配置展示并计算。
2. 信用卡/支付通道服务费可配置，账单与对账可区分。
3. 税费规则可配置，支持多档税率与免税场景。
4. 配置支持总部-区域-门店继承与覆盖。

---

## 8. 数据与接口需求（总则）

### 8.1 数据域

1. 主数据：菜单、门店、组织、员工、会员  
2. 交易数据：订单、支付、退款、库存变更  
3. 集成数据：渠道映射、Webhook 事件、同步日志  
4. 分析数据：事实表 + 聚合指标

### 8.2 接口规范

1. 所有写接口必须支持 `idempotency_key`  
2. 所有 webhook 必须支持签名验证与重放保护  
3. 统一错误码：认证、授权、业务冲突、幂等冲突、限流  
4. 关键实体支持变更日志与版本号

---

## 9. 非功能需求（NFR）

1. 可用性：核心交易链路 99.95%（月）  
2. 性能：门店下单主链路 P95 < 2s（不含第三方渠道外部耗时）  
3. 一致性：订单-支付-库存最终一致，关键状态强一致  
4. 安全：接口签名、TLS、最小权限、审计留痕  
5. 可观测：日志、指标、追踪三件套齐全  
6. 可运维：灰度发布、回滚、告警、事件重放工具

---

## 10. 发布路线图（建议）

## Phase 1（8-12 周，先闭环）

1. M03 订单中心重构  
2. M04 全渠道聚合（可配置骨架）  
3. M05 菜单中心  
4. M08 支付中台（至少双通道能力）  
5. M13 基础对账

## Phase 2（12-16 周，门店可规模化）

1. M06 库存沽清  
2. M07 厨房/KDS  
3. M14 组织连锁  
4. M15 经营报表  
5. M12 劳动力

## Phase 3（企业化增强）

1. M16 离线容灾  
2. M17 设备生态  
3. M18 合作方对接平台  
4. M10/M11 会员营销深化  
5. M20 高级安全合规

---

## 11. 验收与 KPI

### 11.1 业务 KPI

1. 渠道订单自动注入率 >= 99%  
2. 订单错误率下降 >= 60%（相对人工录单）  
3. 菜单改动同步成功率 >= 99.5%  
4. 门店对账差异单率 <= 0.3%

### 11.2 技术 KPI

1. Webhook 事件处理成功率 >= 99.9%  
2. 事件重复处理导致脏数据 = 0（幂等）  
3. 关键接口错误预算达标（按 SLO）

---

## 12. 迁移策略（从当前代码到目标架构）

### 12.1 不破坏现有门店流程

1. 保留现有 `/api/order`、`/api/table`、`/api/payment` 路由兼容层  
2. 新能力通过“中台服务 + 适配层”逐步接管  
3. 先接入单一新渠道做试点，再扩展到多渠道

### 12.2 数据迁移顺序

1. 菜单主数据抽离（替代前端常量）  
2. 订单模型扩展（新增 source/channel 字段）  
3. 支付模型扩展（多通道路由）  
4. 新增 channel 连接与映射表

---

## 13. 风险与缓解

1. 渠道 API 变更频繁  
   - 缓解：适配层隔离 + 契约测试 + 版本回归

2. 多区域税制和支付差异复杂  
   - 缓解：市场模板 + 规则引擎 + 合规参数化

3. Webhook 丢失/乱序  
   - 缓解：事件存储 + 重放 + 幂等 + 补偿任务

4. 门店一线学习成本  
   - 缓解：渐进式启用 + 角色化培训 + 可回退策略

---

## 14. 对标依据（主要来源）

### Toast / Square / 渠道平台（国际）

1. Toast API Reference（Orders/Configuration/Labor/Kitchen/Stock/Analytics/Cash Management/Partners/Restaurant Availability）  
   - https://doc.toasttab.com/openapi/
2. Toast Developer Guide（Webhooks、超时、回退等）  
   - https://doc.toasttab.com/doc/devguide/apiWebhookBasics.html  
   - https://doc.toasttab.com/doc/devguide/apiTimeouts.html  
   - https://doc.toasttab.com/doc/devguide/apiBackOffSupport.html
3. Square API Reference（Orders/Catalog/Inventory/Payments/Refunds/Labor/Team/Customers/Gift Cards/Webhooks）  
   - https://developer.squareup.com/reference
4. Square Restaurants 能力页（KDS、离线支付、外卖渠道管理等）  
   - https://squareup.com/us/en/point-of-sale/restaurants/features
5. Uber Eats Developer（Order Integration / Webhooks）  
   - https://developer.uber.com/docs/eats/guides/order-integration  
   - https://developer.uber.com/docs/eats/guides/webhooks
6. DoorDash Developer（Marketplace API）  
   - https://developer.doordash.com/en-US/api/marketplace
7. Deliveroo Developer Docs（Order/Menu/Site/Webhook）  
   - https://api-docs.deliveroo.com/
8. Grubhub Developers（POS Integration 功能说明，含迁移提示）  
   - https://grubhub-developers.zendesk.com/hc/en-us
9. Toast Hardware（Flex / Go / Kiosk / KDS 等）  
   - https://pos.toasttab.com/hardware/
10. Square Hardware（Register / Stand / Terminal / Kiosk / KDS）  
   - https://squareup.com/us/en/hardware
11. Square Hardware Compatibility（Cash Drawer / Kitchen Printer）  
   - https://squareup.com/us/en/compatibility/accessories/cash-drawers  
   - https://squareup.com/us/en/compatibility/accessories/kitchen-printers

### 中国主流开放平台 / 设备生态

1. 饿了么 OpenAPI（快速入门、订单、推送、补偿、支付）  
   - https://openapi-doc.faas.ele.me/v2/quickstart.html  
   - https://openapi-doc.faas.ele.me/v2/api/signal/index.html  
   - https://openapi-doc.faas.ele.me/v2/api/order-extra.html  
   - https://openapi-doc.faas.ele.me/v2/api/markup.html  
   - https://openapi-doc.faas.ele.me/v2/api/pay.html
2. 二维火 OpenAPI（店铺、外卖、配送、报表、消息）  
   - https://open.2dfire.com/doc/  
   - https://open.2dfire.com/doc/openApiMain.html  
   - https://open.2dfire.com/doc/delivery.html
3. 美团开放平台/配送技术服务中心（对接能力入口与调用规范）  
   - https://openapi.waimai.meituan.com/program/general  
   - https://peisong.meituan.com/open/doc
4. 商米开发者平台（打印/扫码/称重/副屏等设备能力）  
   - https://developer.sunmi.com/zh-CN/

---

## 15. 结论（本次合并产物）

1. 已将“当前版本能力”与“20 项差距能力”合并为统一 PRD。  
2. “全渠道订单聚合”已明确为可配置架构，不绑定任何单一国家平台。  
3. 文档可直接进入：架构设计 -> 接口定义 -> Phase 1 排期。

---

## 16. 分阶段开发计划（执行版）

> 计划起始日：2026-03-02（周一）  
> 迭代节奏：2 周 / Sprint  
> 发布节奏：4 周一次稳定版本，8-12 周一次里程碑版本  
> 总周期：约 54 周（到 2027-03-19）

### 16.1 团队编组建议

1. Core Transaction Squad（订单/桌台/收银）
   - 3 后端 + 2 前端 + 1 QA
2. Channel Integration Squad（全渠道/菜单同步/Webhook）
   - 4 后端 + 1 QA
3. Store Operation Squad（KDS/库存/设备）
   - 2 后端 + 2 前端 + 1 QA
4. Platform & Data Squad（对账/报表/可观测/DevOps）
   - 2 后端 + 1 数据工程 + 1 DevOps/SRE + 1 QA
5. 产品与设计
   - 1 产品经理 + 1 设计师 + 1 技术项目经理（可兼任）

### 16.2 阶段总览

| 阶段 | 时间（预计） | 目标 | 对应模块 |
|---|---|---|---|
| Phase 0 | 2026-03-02 ~ 2026-03-27（4周） | 基线加固与架构准备 | M01/M03 基础、工程化 |
| Phase 1 | 2026-03-30 ~ 2026-05-22（8周） | 订单中心重构 + 可配置全渠道骨架 + 菜单中心 v1 | M03/M04/M05/M01 |
| Phase 2 | 2026-05-25 ~ 2026-08-14（12周） | 门店运营闭环（库存/KDS/桌台高级/支付中台/现金） | M02/M06/M07/M08/M09 |
| Phase 3 | 2026-08-17 ~ 2026-10-30（11周） | 连锁经营系统（组织/劳动力/财务/报表/营销会员） | M10/M11/M12/M13/M14/M15 |
| Phase 4 | 2026-11-02 ~ 2027-01-22（12周） | 平台化与全球化（合作方对接/离线/设备/合规） | M16/M17/M18/M20 |
| Phase 5 | 2027-01-25 ~ 2027-03-19（8周） | 多区域试点与 GA | 全模块压测与上线 |

### 16.3 各阶段详细交付

## Phase 0（架构准备，4周）

### 目标

把当前 MVP 从“功能可跑”提升到“可持续迭代”。

### 交付物

1. 统一领域模型草案（Order/Menu/Payment/Channel）  
2. API 规范与错误码规范（含 `idempotency_key`）  
3. 审计日志基础框架（登录、订单更新、支付动作）  
4. CI/CD、自动化测试骨架、环境分层（dev/staging/prod）  
5. 监控基础：日志、指标、追踪（至少接入一套 APM）

### 退出标准（Gate）

1. 所有写接口支持幂等键  
2. 主链路自动化回归用例通过率 >= 90%  
3. staging 可完成“登录->下单->收款->打印”

---

## Phase 1（订单与全渠道骨架，8周）

### 目标

先完成“可配置全渠道 + 统一订单中心 + 菜单中心 v1”。

### 交付物

1. 订单中心重构（M03）
   - 统一订单模型：`sourceType/channelProviderCode/externalOrderId`
   - 订单状态机标准化与冲突处理
2. 全渠道可配置中台骨架（M04）
   - `ChannelProvider`、`MarketProfile`、`StoreChannelConnection`、`ChannelMappingRule`
   - Webhook 接入、重试、死信队列、事件重放工具
3. 菜单中心 v1（M05）
   - 菜单后台 CRUD、版本（草稿/发布）
   - 从当前前端常量迁移到后端主数据
4. 权限与审计 v1（M01）
   - 页面级和操作级权限
   - 审计日志查询页（基础）

### 试点接入策略

1. 至少接入 2 个渠道连接器（建议：1 个中国渠道 + 1 个北美渠道）  
2. 新增连接器必须通过配置启用，不允许改核心订单逻辑

### 退出标准（Gate）

1. 2 个渠道可在配置后台独立开关  
2. 漏单率 <= 1%（staging 压测场景）  
3. 菜单变更可发布并同步到已接入渠道（v1）

---

## Phase 2（门店运营闭环，12周）

### 目标

打通“接单 -> 厨房 -> 出餐 -> 收银 -> 现金班次”的门店完整闭环。

### 交付物

1. 桌台高级能力（M02）
   - 并台、拆台、转台、分单/并单
2. 库存与沽清（M06）
   - 实时扣减、低库存预警、自动 86
3. 厨房 KDS（M07）
   - 工位路由、备餐计时、催菜、出餐确认
4. 支付中台 v1（M08）
   - 多支付通道路由 + 失败切换
   - 全额/部分退款
5. 现金管理（M09）
   - 开班/交班、抽屉流水、盘点差异

### 退出标准（Gate）

1. 门店可连续营业日完成完整交易闭环  
2. 订单-库存-支付一致性差异 <= 0.3%  
3. 高峰时段（目标 QPS）下 P95 下单链路 < 2s（不含第三方外部耗时）

---

## Phase 3（连锁经营系统，11周）

### 目标

完成总部视角的“组织、财务、分析、营销、员工”能力。

### 交付物

1. 组织与连锁（M14）
   - Brand/Region/Store 层级与配置继承
2. 劳动力（M12）
   - 排班、打卡、工时
3. 财务结算与对账（M13）
   - 订单/支付/退款总账
   - 渠道对账与差异归因
4. 经营分析（M15）
   - 销售/渠道/支付/库存主题报表
5. 会员与营销 v1（M10/M11）
   - 会员档案、积分规则、优惠券基础核销

### 退出标准（Gate）

1. 总部可按区域/门店查看经营与财务报表  
2. 对账差异可追踪到订单级  
3. 营销活动可配置并在订单中正确结算

---

## Phase 4（平台化与全球化，12周）

### 目标

把产品从“可运营”升级为“可规模复制”。

### 交付物

1. 合作方对接平台（M18）
   - 对外 API、Webhook 签名、回放、限流、沙箱
2. 离线与容灾（M16）
   - 断网收银、恢复重放、冲突修复队列
3. 设备生态（M17）
   - 打印/KDS/扫码/客显/手持设备接入规范
4. 合规与安全（M20）
   - 密钥轮换、PII 策略、高风险审批（可选）
5. 区域模板完善
   - 中国、东南亚、美国、加拿大、爱尔兰配置模板固化

### 退出标准（Gate）

1. 合作方可完成标准化接入  
2. 离线场景可恢复且不产生重复脏单  
3. 多国家模板可通过配置启用

---

## Phase 5（试点扩张与 GA，8周）

### 目标

完成多区域试点，达到正式商用（GA）门槛。

### 交付物

1. 试点上线与运维手册（按国家）  
2. 数据迁移与回滚预案  
3. 压测、故障演练、应急响应流程  
4. 培训包：店长/收银/服务员/财务/总部运营

### 建议试点路径

1. 批次 A：5-10 家门店（单一国家）  
2. 批次 B：20-30 家门店（双区域）  
3. 批次 C：跨国家小规模（验证模板与合规）

### GA 退出标准（最终）

1. 核心交易 SLO 达标（99.95%）  
2. 渠道注单成功率 >= 99%  
3. 对账差异单率 <= 0.3%  
4. P0 缺陷清零，P1 缺陷可控并有修复计划

### 16.4 模块与阶段映射（落地顺序）

1. 第一批（Phase 0-1）：M01/M03/M04/M05  
2. 第二批（Phase 2）：M02/M06/M07/M08/M09  
3. 第三批（Phase 3）：M10/M11/M12/M13/M14/M15  
4. 第四批（Phase 4）：M16/M17/M18/M20  
5. 持续增强（Phase 3-5）：M19 + M18 深化 + M20 强化

### 16.5 关键依赖与前置条件

1. 渠道对接商务与沙箱权限需在 Phase 1 前拿到  
2. 支付通道合同与技术文档需在 Phase 2 前锁定  
3. 设备厂商 SDK 与测试机需在 Phase 4 前到位  
4. 法务/财务合规评审需在跨国家试点前完成

### 16.6 管理机制（每两周）

1. Sprint Planning：确认范围、风险、依赖  
2. Mid-Sprint Review：检查阻塞与接口稳定性  
3. Sprint Review：演示可运行闭环  
4. Release Readiness：灰度/回滚/告警策略检查
